# This schedule performs elementw-wise pruning of all convolutional,
# bathnorm and fully connected layers in MobileNetV2 for first epoch

version: 1
pruners:
  mobilenetv2_conv:
    class: 'SparsityLevelParameterPruner'
    levels:
      'module.features.0.0.weight': 1.0
      'module.features.1.conv.0.weight': 1.0
      'module.features.1.conv.3.weight': 1.0
      'module.features.2.conv.0.weight': 1.0
      'module.features.2.conv.3.weight': 1.0
      'module.features.2.conv.6.weight': 1.0
      'module.features.3.conv.0.weight': 1.0
      'module.features.3.conv.3.weight': 1.0
      'module.features.3.conv.6.weight': 1.0
      'module.features.4.conv.0.weight': 1.0
      'module.features.4.conv.3.weight': 1.0
      'module.features.4.conv.6.weight': 1.0
      'module.features.5.conv.0.weight': 1.0
      'module.features.5.conv.3.weight': 1.0
      'module.features.5.conv.6.weight': 1.0
      'module.features.6.conv.0.weight': 1.0
      'module.features.6.conv.3.weight': 1.0
      'module.features.6.conv.6.weight': 1.0
      'module.features.7.conv.0.weight': 1.0
      'module.features.7.conv.3.weight': 1.0
      'module.features.7.conv.6.weight': 1.0
      'module.features.8.conv.0.weight': 1.0
      'module.features.8.conv.3.weight': 1.0
      'module.features.8.conv.6.weight': 1.0
      'module.features.9.conv.0.weight': 1.0
      'module.features.9.conv.3.weight': 1.0
      'module.features.9.conv.6.weight': 1.0
      'module.features.10.conv.0.weight': 1.0
      'module.features.10.conv.3.weight': 1.0
      'module.features.10.conv.6.weight': 1.0
      'module.features.11.conv.0.weight': 1.0
      'module.features.11.conv.3.weight': 1.0
      'module.features.11.conv.6.weight': 1.0
      'module.features.12.conv.0.weight': 1.0
      'module.features.12.conv.3.weight': 1.0
      'module.features.12.conv.6.weight': 1.0
      'module.features.13.conv.0.weight': 1.0
      'module.features.13.conv.3.weight': 1.0
      'module.features.13.conv.6.weight': 1.0
      'module.features.14.conv.0.weight': 1.0
      'module.features.14.conv.3.weight': 1.0
      'module.features.14.conv.6.weight': 1.0
      'module.features.15.conv.0.weight': 1.0
      'module.features.15.conv.3.weight': 1.0
      'module.features.15.conv.6.weight': 1.0
      'module.features.16.conv.0.weight': 1.0
      'module.features.16.conv.3.weight': 1.0
      'module.features.16.conv.6.weight': 1.0
      'module.features.17.conv.0.weight': 1.0
      'module.features.17.conv.3.weight': 1.0
      'module.features.17.conv.6.weight': 1.0
      'module.features.18.0.weight': 1.0

  mobilenetv2_batchnorm:
    class: 'SparsityLevelParameterPruner'
    levels:
      'module.features.0.1.weight': 1.0
      'module.features.1.conv.1.weight': 1.0
      'module.features.1.conv.4.weight': 1.0
      'module.features.2.conv.1.weight': 1.0
      'module.features.2.conv.4.weight': 1.0
      'module.features.2.conv.7.weight': 1.0
      'module.features.3.conv.1.weight': 1.0
      'module.features.3.conv.4.weight': 1.0
      'module.features.3.conv.7.weight': 1.0
      'module.features.4.conv.1.weight': 1.0
      'module.features.4.conv.4.weight': 1.0
      'module.features.4.conv.7.weight': 1.0
      'module.features.5.conv.1.weight': 1.0
      'module.features.5.conv.4.weight': 1.0
      'module.features.5.conv.7.weight': 1.0
      'module.features.6.conv.1.weight': 1.0
      'module.features.6.conv.4.weight': 1.0
      'module.features.6.conv.7.weight': 1.0
      'module.features.7.conv.1.weight': 1.0
      'module.features.7.conv.4.weight': 1.0
      'module.features.7.conv.7.weight': 1.0
      'module.features.8.conv.1.weight': 1.0
      'module.features.8.conv.4.weight': 1.0
      'module.features.8.conv.7.weight': 1.0
      'module.features.9.conv.1.weight': 1.0
      'module.features.9.conv.4.weight': 1.0
      'module.features.9.conv.7.weight': 1.0
      'module.features.10.conv.1.weight': 1.0
      'module.features.10.conv.4.weight': 1.0
      'module.features.10.conv.7.weight': 1.0
      'module.features.11.conv.1.weight': 1.0
      'module.features.11.conv.4.weight': 1.0
      'module.features.11.conv.7.weight': 1.0
      'module.features.12.conv.1.weight': 1.0
      'module.features.12.conv.4.weight': 1.0
      'module.features.12.conv.7.weight': 1.0
      'module.features.13.conv.1.weight': 1.0
      'module.features.13.conv.4.weight': 1.0
      'module.features.13.conv.7.weight': 1.0
      'module.features.14.conv.1.weight': 1.0
      'module.features.14.conv.4.weight': 1.0
      'module.features.14.conv.7.weight': 1.0
      'module.features.15.conv.1.weight': 1.0
      'module.features.15.conv.4.weight': 1.0
      'module.features.15.conv.7.weight': 1.0
      'module.features.16.conv.1.weight': 1.0
      'module.features.16.conv.4.weight': 1.0
      'module.features.16.conv.7.weight': 1.0
      'module.features.17.conv.1.weight': 1.0
      'module.features.17.conv.4.weight': 1.0
      'module.features.17.conv.7.weight': 1.0
      'module.features.18.1.weight': 1.0

  mobilenetv2_fullyconnected:
    class: 'SparsityLevelParameterPruner'
    levels:
      'module.features.18.1.weight': 1.0
      'module.classifier.1.weight': 1.0

lr_schedulers:
  pruning_lr:
    class: ExponentialLR
    gamma: 0.9

policies:
  - pruner:
      instance_name: 'mobilenetv2_conv'
    starting_epoch: 0
    ending_epoch: 1
    frequency: 1
  - pruner:
      instance_name: 'mobilenetv2_batchnorm'
    starting_epoch: 0
    ending_epoch: 1
    frequency: 1
  - pruner:
      instance_name: 'mobilenetv2_fullyconnected'
    starting_epoch: 0
    ending_epoch: 1
    frequency: 1
  - lr_scheduler:
      instance_name: pruning_lr
    starting_epoch: 1
    ending_epoch: 2
    frequency: 1
