# This schedule performs 3D (filter-wise) regularization of all convolutional, bathnorm and ReLU6 layers in MobileNetV2
# for the first epoch only

version: 1
pruners:
  # NOTE: this part is the name, pretty sure you can define it yourself
  mobile_manual:
    class: 'L1RankedStructureParameterPruner'
    group_type: Filters
    desired_sparsity: 0.8
    # NOTE: put in the names of the modules - get this from running model-summary.py in this dir
    weights: [
      features.module.2.weight,
      features.module.5.weight,
      features.module.7.weight,
      features.module.10.weight,
      features.module.12.weight,
      features.module.14.weight,
      features.module.16.weight,
      features.module.19.weight]

extensions:
  net_thinner:
      class: 'FilterRemover'
      thinning_func_str: remove_filters
      arch: 'mobilenetv2'
      # NOTE: need to check I have set up dataset in distiller properly
      dataset: 'ucf101'

lr_schedulers:
  # Learning rate decay scheduler
  pruning_lr:
    class: StepLR
    step_size: 50
    gamma: 0.10


policies:
  # NOTE: tells the compression scheduler when to apply the defined pruning
  - pruner:
      instance_name: mobile_manual
    epochs: [0]

  - extension:
      instance_name: net_thinner
    epochs: [0]
