# This schedule performs 3D (filter-wise) regularization of all convolutional, bathnorm and ReLU6 layers in MobileNetV2
# for the first epoch only

version: 1
pruners:
  # NOTE: this part is the name, pretty sure you can define it yourself
  mobile_manual:
    class: 'L1RankedStructureParameterPruner'
    group_type: Filters
    desired_sparsity: 0.5
    # NOTE: put in the names of the modules - get this from running model-summary.py in this dir
    weights: ['module.module.features.0.0.weight',
    'module.module.features.0.1.weight',
    'module.module.features.1.conv.0.weight',
    'module.module.features.1.conv.1.weight',
    'module.module.features.1.conv.3.weight',
    'module.module.features.1.conv.4.weight',
    'module.module.features.2.conv.0.weight',
    'module.module.features.2.conv.1.weight',
    'module.module.features.2.conv.3.weight',
    'module.module.features.2.conv.4.weight',
    'module.module.features.2.conv.6.weight',
    'module.module.features.2.conv.7.weight',
    'module.module.features.3.conv.0.weight',
    'module.module.features.3.conv.1.weight',
    'module.module.features.3.conv.3.weight',
    'module.module.features.3.conv.4.weight',
    'module.module.features.3.conv.6.weight',
    'module.module.features.3.conv.7.weight',
    'module.module.features.4.conv.0.weight',
    'module.module.features.4.conv.1.weight',
    'module.module.features.4.conv.3.weight',
    'module.module.features.4.conv.4.weight',
    'module.module.features.4.conv.6.weight',
    'module.module.features.4.conv.7.weight',
    'module.module.features.5.conv.0.weight',
    'module.module.features.5.conv.1.weight',
    'module.module.features.5.conv.3.weight',
    'module.module.features.5.conv.4.weight',
    'module.module.features.5.conv.6.weight',
    'module.module.features.5.conv.7.weight',
    'module.module.features.6.conv.0.weight',
    'module.module.features.6.conv.1.weight',
    'module.module.features.6.conv.3.weight',
    'module.module.features.6.conv.4.weight',
    'module.module.features.6.conv.6.weight',
    'module.module.features.6.conv.7.weight',
    'module.module.features.7.conv.0.weight',
    'module.module.features.7.conv.1.weight',
    'module.module.features.7.conv.3.weight',
    'module.module.features.7.conv.4.weight',
    'module.module.features.7.conv.6.weight',
    'module.module.features.7.conv.7.weight',
    'module.module.features.8.conv.0.weight',
    'module.module.features.8.conv.1.weight',
    'module.module.features.8.conv.3.weight',
    'module.module.features.8.conv.4.weight',
    'module.module.features.8.conv.6.weight',
    'module.module.features.8.conv.7.weight',
    'module.module.features.9.conv.0.weight',
    'module.module.features.9.conv.1.weight',
    'module.module.features.9.conv.3.weight',
    'module.module.features.9.conv.4.weight',
    'module.module.features.9.conv.6.weight',
    'module.module.features.9.conv.7.weight',
    'module.module.features.10.conv.0.weight',
    'module.module.features.10.conv.1.weight',
    'module.module.features.10.conv.3.weight',
    'module.module.features.10.conv.4.weight',
    'module.module.features.10.conv.6.weight',
    'module.module.features.10.conv.7.weight',
    'module.module.features.11.conv.0.weight',
    'module.module.features.11.conv.1.weight',
    'module.module.features.11.conv.3.weight',
    'module.module.features.11.conv.4.weight',
    'module.module.features.11.conv.6.weight',
    'module.module.features.11.conv.7.weight',
    'module.module.features.12.conv.0.weight',
    'module.module.features.12.conv.1.weight',
    'module.module.features.12.conv.3.weight',
    'module.module.features.12.conv.4.weight',
    'module.module.features.12.conv.6.weight',
    'module.module.features.12.conv.7.weight',
    'module.module.features.13.conv.0.weight',
    'module.module.features.13.conv.1.weight',
    'module.module.features.13.conv.3.weight',
    'module.module.features.13.conv.4.weight',
    'module.module.features.13.conv.6.weight',
    'module.module.features.13.conv.7.weight',
    'module.module.features.14.conv.0.weight',
    'module.module.features.14.conv.1.weight',
    'module.module.features.14.conv.3.weight',
    'module.module.features.14.conv.4.weight',
    'module.module.features.14.conv.6.weight',
    'module.module.features.14.conv.7.weight',
    'module.module.features.15.conv.0.weight',
    'module.module.features.15.conv.1.weight',
    'module.module.features.15.conv.3.weight',
    'module.module.features.15.conv.4.weight',
    'module.module.features.15.conv.6.weight',
    'module.module.features.15.conv.7.weight',
    'module.module.features.16.conv.0.weight',
    'module.module.features.16.conv.1.weight',
    'module.module.features.16.conv.3.weight',
    'module.module.features.16.conv.4.weight',
    'module.module.features.16.conv.6.weight',
    'module.module.features.16.conv.7.weight',
    'module.module.features.17.conv.0.weight',
    'module.module.features.17.conv.1.weight',
    'module.module.features.17.conv.3.weight',
    'module.module.features.17.conv.4.weight',
    'module.module.features.17.conv.6.weight',
    'module.module.features.17.conv.7.weight',
    'module.module.features.18.0.weight',
    'module.module.features.18.1.weight',
    'module.module.classifier.1.weight']

# NOTE: this was the previous layout
# features.module.2.weight,
# features.module.5.weight,
# features.module.7.weight,
# features.module.10.weight,
# features.module.12.weight,
# features.module.14.weight,
# features.module.16.weight,
# features.module.19.weight

extensions:
  net_thinner:
      class: 'FilterRemover'
      thinning_func_str: remove_filters
      arch: 'mobilenetv2'
      # NOTE: need to check I have set up dataset in distiller properly
      dataset: 'ucf101'

lr_schedulers:
  # Learning rate decay scheduler
  pruning_lr:
    class: StepLR
    step_size: 50
    gamma: 0.10


policies:
  # NOTE: tells the compression scheduler when to apply the defined pruning
  - pruner:
      instance_name: mobile_manual
    epochs: [0]

  - extension:
      instance_name: net_thinner
    epochs: [0]
